# Delta of Deltas Algorithm - Continuation Notes

## Current Status: Phase 1 Complete, Saffron Running

**Active Run Key**: `delta_phases_20251006_221135`
- **119 works** selected with canonicity >= 3.0 and text files
- **119 progressive corpora** generated (corpus_0001.json through corpus_0119.json)
- **Saffron currently running** via `delta_of_deltas/delta_phases_20251006_221135/run_saffron.sh`

## Algorithm Overview

**4-Phase Progressive Convergence Detection:**

1. **Phase 1**: Generate progressive Saffron corpus files
   - `bin/rake delta_phases:saffron_runs[max_works,min_canonicity]`
   - Creates corpus_0001 (1 work), corpus_0002 (2 works), ..., corpus_N (N works)
   - Each corpus contains all previous works + one new work (significance ordered)

2. **Phase 2**: Calculate deltas between adjacent Saffron results
   - `bin/rake delta_phases:calculate_deltas[phase_key]`
   - Compares terms between corpus_0001→0002, corpus_0002→0003, etc.
   - Uses TermWeightStrategy (CompositeStrategy with others disabled for now)

3. **Phase 3**: Calculate delta of deltas for convergence detection
   - `bin/rake delta_phases:delta_of_deltas[phase_key]`
   - Analyzes rate of change between adjacent deltas
   - Detects when term extraction stabilizes (convergence)

4. **Phase 4**: Analysis and visualization (future)

## Key Findings So Far

- **Total works in DB**: 3,654
- **Works with text files**: 898
- **High canonicity works (>=3.0)**: 119 (what we're testing)
- **Previous 9-work test**: No convergence - oscillating deltas (0.288→0.150→0.348→...)
- **Hypothesis**: Need more works to see convergence in philosophical terminology

## Technical Implementation

**Files Added/Modified:**
- `lib/delta_analysis/` - Core algorithm modules
- `lib/tasks/delta_phases.rake` - 4-phase rake tasks
- `lib/tasks/delta_analysis.rake` - Original monolithic tasks  
- `app/models/fyle.rb` - Added `absolute_local_file_path()` method
- `docs/DELTA_OF_DELTAS_*.md` - Algorithm documentation

**Working Pipeline:**
- ✅ Phase 1: Progressive corpus generation
- ✅ Phase 2: Delta calculations (with format fixes)
- ✅ Phase 3: Delta of deltas analysis
- ✅ Saffron integration with proper config format
- ✅ Database integration via WorkBasedDeltaProcessor

## Current Execution

**Saffron Status**: Currently processing 119 progressive corpora
**Next Steps When Complete**:
1. `bin/rake delta_phases:calculate_deltas[delta_of_deltas/delta_phases_20251006_221135]`
2. `bin/rake delta_phases:delta_of_deltas[delta_of_deltas/delta_phases_20251006_221135]`
3. Analyze convergence patterns with 119 high-canonicity philosophical works

## Key Insights

**Convergence Theory**: Philosophical terminology should stabilize as we add more works. If it doesn't converge even with 119 works, it suggests philosophical vocabulary is genuinely diverse rather than having a finite core vocabulary.

**Technical Success**: 4-phase pipeline working correctly, proper Saffron integration, database relationships mapped, file path normalization complete.

**Scale**: This is the largest test so far - previous tests with 9 works showed oscillation, 119 works should reveal true convergence patterns.