# AI Session Context - Works Population Project

**Date**: 2025-10-07
**Status**: In Progress - Planning Phase

## What We Were Working On

Adding more philosophical works to the database. Currently:
- **13,329 philosophers** in database
- **3,654 works** in database (goal: increase this significantly)

## Current Situation

### SPARQL Query Analysis
Ran the `THESE_WORKS_BY_PHILOSOPHERS` query on Wikidata Query Service:
- **Returns**: 21,792 items
- **Issue**: Includes many non-philosophical works (literary work, written work, manifesto, etc.)

### Work Types Currently in Database
Top work types by count:
```
2606: book
 160: literary work
  98: play
  93: poem
  92: scientific article
  51: work
  40: essay
  38: biographical article
  36: letter
  35: short story
  23: speech
  ...etc
```

### The Work Population System

**Key Files**:
- `lib/tasks/shadow/work_tasks.rake` - Contains work population tasks
- `lib/wikidata/sparql_queries.rb` - Contains SPARQL query definitions
- `lib/wikidata/query_executor.rb` - Executes queries with logging

**Key Functions**:
- `deez_wurks(q)` - Main function that processes SPARQL results and creates Work records (line 93 in work_tasks.rake)
  - Takes philosopher-work pairs from Wikidata
  - Creates `Work` records and `Expression` records (philosopher-work link)
  - Only adds works if philosopher already exists in database

**Available Queries**:
1. `works1` → Uses `THESE_WORKS_BY_PHILOSOPHERS` (notable works by philosophers)
2. `works2` → Uses `THESE_PHILOSOPHICAL_WORKS` (works categorized as philosophy genre)

**Commands**:
```bash
# See SPARQL query with debug output
SPARQL_DEBUG=true bin/rake shadow:work:populate[works1]

# Actually populate (not run yet!)
bin/rake shadow:work:populate[works1]
```

## Important Pattern: Shadow.none

**CRITICAL**: Always call `Shadow.none` before accessing `Philosopher` or `Work` classes to initialize STI (Single Table Inheritance) properly.

```ruby
# Correct
Shadow.none
Philosopher.count

# Wrong
Philosopher.count  # May fail or behave unexpectedly
```

## Next Steps (Not Yet Completed)

### Immediate Decision Needed
**Should we filter by work type before populating database?**

Three options discussed:

**Option 1: Modify SPARQL query** - Add positive filters for philosophical work types
- Pros: Cleaner data at source
- Cons: Requires re-querying Wikidata each time we adjust filters

**Option 2: Add more negative SPARQL filters** - Exclude non-philosophical types
- Pros: Same as Option 1
- Cons: Potentially long filter list

**Option 3: Post-process filtering** (RECOMMENDED)
- Modify `deez_wurks` function to filter by `whatLabel` before saving
- Pros: Flexible, can iterate without re-querying Wikidata
- Cons: Need to define whitelist/blacklist

### Tasks to Complete

1. **Define work type filtering strategy**
   - Create whitelist/blacklist of acceptable `whatLabel` values
   - Possibly create a configuration file or database table

2. **Modify deez_wurks function** (if going with Option 3)
   - Add filtering logic before `Work.new()`
   - Log filtered-out works for review

3. **Test run**
   - Run populate with small subset first
   - Review what gets added vs filtered

4. **Full population**
   - Run `bin/rake shadow:work:populate[works1]`
   - Monitor progress and errors
   - Check results

5. **Consider works2 query**
   - Compare results from `THESE_PHILOSOPHICAL_WORKS`
   - May capture different works

## Questions to Answer Next Session

1. What work types should we definitely include? (book, essay, treatise, ?)
2. What work types should we definitely exclude? (manifesto, play, poem, ?)
3. Should "literary work" and "written work" be excluded as too generic?
4. Do we want to keep existing works (poems, plays, letters) or should we mark them obsolete?

## Files Modified This Session

- `.ai-instructions.md` (via CLAUDE.md symlink) - Added comprehensive documentation:
  - Common Development Tasks section
  - Data Model Details section
  - Delta-of-Deltas Text Convergence Analysis section
  - Rake Task Organization section
  - Asset Pipeline & Bower Integration section
  - Updated Documentation Structure

## Key Documentation References

- `docs/SPARQL_DEBUGGING.md` - How to use SPARQL_DEBUG and SPARQL_LOG
- `docs/RAKE_TASKS.md` - Documentation of rake tasks
- `lib/wikidata/sparql_queries.rb` - All SPARQL query definitions
- `lib/tasks/shadow/work_tasks.rake:93` - The `deez_wurks` function

---

# Previous Session: Delta of Deltas Algorithm

## Status: Phase 1 Complete, Saffron Running

**Active Run Key**: `delta_phases_20251006_221135`
- **119 works** selected with canonicity >= 3.0 and text files
- **119 progressive corpora** generated (corpus_0001.json through corpus_0119.json)
- **Saffron currently running** via `delta_of_deltas/delta_phases_20251006_221135/run_saffron.sh`
